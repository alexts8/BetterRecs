<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>Home</title>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style/style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
  <h1> BetterRecs. </h1>
  <div class = "nav-buttons">
    <button onclick="location.href='{{ url_for('redirect_page') }}'">Home</button>
    <button>About</button>
    <button onclick="window.open('{{ url_for('logout') }}', '_blank')">Logout</button>
  </div>
  </header>
  <h1 id = "recommendations-header">Recommendations</h1>
  <table>
    <tr>
      <th>Artist Name</th>
      <th>Song Name</th>
      <th>Listen</th>
      <th>Remove</th>
    </tr>
    {% for artist, song in recommendations_dict.items() %}
    {% set id = song_ids_list[loop.index0] %}
    <tr>
      <td>{{ artist }}</td>
      <td>{{ song }}</td>
      <td><button id = "listen-button" onclick="window.open('https://open.spotify.com/track/{{ id }}', '_blank')">Listen Here</button></td>
      <td><button id = "delete-button" onclick="deleteRow(this)">Delete</button></td> 
    </tr>
    {% endfor %}
  </table>

  <script>
    function deleteRow(button) {
      var row = button.parentNode.parentNode;
      row.parentNode.removeChild(row); 
    }
  </script>

  <button class = "add-playlist" onclick="addToPlaylist()">Add To Playlist</button>

  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script>
    function addToPlaylist() {
      var songIds = [];

      {% for id in song_ids_list %}
        songIds.push('{{ id }}');
      {% endfor %}

      $.ajax({
        type: 'POST',
        url: '{{ url_for('create_playlist') }}',
        contentType: 'application/json;charset=UTF-8',
        data: JSON.stringify({ songIds: songIds }),
        success: function(response) {
          console.log('Playlist created successfully');
        },
        error: function(error) {
          console.error('Error creating playlist:', error);
        }
      });
    }
  </script>


</body>
</html>
